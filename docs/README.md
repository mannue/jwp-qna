## STEP1 - Entity Mapping

### 요구 사항

- DDL 을 보고 유추해라

```sql
create table answer
(
    id          bigint generated by default as identity,
    contents    clob,
    created_at  timestamp not null,
    deleted     boolean   not null,
    question_id bigint,
    updated_at  timestamp,
    writer_id   bigint,
    primary key (id)
)    
```

```sql
create table delete_history
(
    id            bigint generated by default as identity,
    content_id    bigint,
    content_type  varchar(255),
    create_date   timestamp,
    deleted_by_id bigint,
    primary key (id)
)   
```
```sql
create table question
(
    id         bigint generated by default as identity,
    contents   clob,
    created_at timestamp    not null,
    deleted    boolean      not null,
    title      varchar(100) not null,
    updated_at timestamp,
    writer_id  bigint,
    primary key (id)
)
```
```sql
create table user
(
    id         bigint generated by default as identity,
    created_at timestamp   not null,
    email      varchar(50),
    name       varchar(20) not null,
    password   varchar(20) not null,
    updated_at timestamp,
    user_id    varchar(20) not null,
    primary key (id)
)

alter table user
    add constraint UK_a3imlf41l37utmxiquukk8ajc unique (user_id)
```

- @DataJpaTest 를 사용하여 학습 테스트를 해본다.

### class 정의
- Answer 
  - Long type 의 id 이라는 멤버 변수를 가지며 해당 값은 primary key 이다. 
  - primary key 는 데이터베이스에 의해 자동으로 삽입 된다.
  - String type 의 contents 멤버 변수는 답변에 대한 content 정보를 가진다.
  - TimeStamp type 의 createAt 멤버 변수는 Answer 객체가 생성시 현재 시간정보를 가진다.
  - boolean type 의 deleted 멤버 변수는 삭제 여부를 정보를 가지며, default 값은 false 이다.
  - Question class 정보를 가진다.
  - TimeStamp type 의 updatedAt 는 업데이트 되는 시간 정보를 가지며 초기값에는 값이 없다.
  - 작성자 user 정보를 가진다.
  
- DeleteHistory
  - Long type 의 id 이라는 멤버 변수를 가지며 해당 값은 primary key 이다. 
  - Question or Answer 의 id 에 대한 정보를 가진다.
  - Question 인지 Answer 인지 Enum 정보를 가진다.
  - TimeStamp type 의 createDate 는 삭제된 정보를 가진다.
  - Long Type 의 deletedById 는 삭제한 사용자 정보를 가진다.

- Question 
  - 질문에 대한 정보는 contents 멤버 변수가 가진다.
  - 질문이 생성시 현시간 정보를 자동으로 기입한다.
  - 삭제 여부를 확인하는 deleted flag 정보를 가진다.
  - 질문의 title 에 대한 정보를 가진다. title 의 크기는 100글자 이내이다.
  - 업데이트 된 날짜 정보를 가진 멤버변수를 가진다.
  - 질문한 사용자의 정보를 가진다.

- User
  - 사용자를 생성시 생성한 날짜 정보를 가진다.
  - 사용자 email 정보를 가진다.
  - 사용자의 이름을 저장하며 해당 값은 필수 입력 값이다.
  - 사용자의 비밀번호 정보를 가지며 해당 값은 필수 입력 값이다.
  - 사용자 정보가 업데이트 되면 해당 시간을 저장한다.
  - 사용자 아이디를 저장하며 해당 값은 필수 입력 값이며 unique 한 값이다.



-------------

## STEP 2 연관 관계 매핑


### 요구 사항 
- QnA 서비스를 만들어가면서 JPA로 실제 도메인 모델을 어떻게 구성하고 객체와 테이블을 어떻게 매핑해야 하는지 알아본다.

### 데이터 베이스 정의
- 질문은  많은 답변은 가진다.
- 답변은 질문 정보를 알수 있다.
- 다대일 양방향 이며 Answer Entity 가 FK 주인 이다.

- 질문은 사용자를 참조한다.
- 다대일 단방향 이며 Question Entity 가 FK 주인 이다.

- 답변은 사용자를 참조한다.
- 다대일 단방향 이며 Answer Entity 가 FK 주인 이다.

- 삭제된 정보는 사용자 정보를 가지고 있다.
- 다대일 단방향 이며 DeleteHistory Entity 가 FK 주인 이다.


-----------------

## STEP3 질문 삭제하기 리팩토링


### 요구 사항
- 질문 데이터를 완전히 삭제하는 것이 아니라 데이터의 상태를 삭제 상태로 변경

- 로그인 사용자와 질문한 사람이 같은 경우 삭제 할수 있다.
- 답변이 없는 경우 삭제가 가능하다.
- 질문자와 답변 글의 모든 답변자가 같은 경우 삭제가 가능하다.

- 질문자와 답변자가 다른 경우 답변을 삭제 할수 없다.
- 질문을 삭제 할때 답변 또한 삭제해야 하며, 답변의 삭제 또한 삭제 상태를 변경한다.

- 질문과 답변 삭제 이력에 대한 정보를 DeleteHistory 를 활용해 남긴다.

### class 기능 요구 사항 추가
#### Question
- 질문은 삭제 할수 있다.
- 질문은 현재 질문의 상태가 삭제되지 않을 경우에만 삭제를 할수 있다.
- 짊문은 로그인 사용자와 같을 경우과 답변 사용자가 일치한 경우에만 삭제 할수 있다.
- 질문 삭제시 status 를 변경한다.
- 질문 삭제시 DeleteHistory 객체를 넘겨준다.

#### Answer
- 답변은 삭제시 질문 간의 연관 관계를 끊는다.
- 삭제후 DeleteHistory 객체를 넘겨준다.

#### Answers
- 삭제 객체를 관리를 한다.
- remove 메소드에 user 정보를 입력받는다.
- 질문들을 삭제한 후에는 DeleteHistories 객체를 넘겨준다.

#### DeleteHistories 
- 삭제된 DeleteHistory 정보를 관리한다.


